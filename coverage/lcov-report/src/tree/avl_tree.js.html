<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/tree/avl_tree.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../index.html">All files</a> / <a href="index.html">src/tree</a> avl_tree.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">95.71% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>67/70</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">94.12% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>32/34</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">91.67% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>11/12</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">96.92% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>63/65</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">81x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1961x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1914x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1914x</span>
<span class="cline-any cline-yes">899x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1015x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1914x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1916x</span>
<span class="cline-any cline-yes">9374x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9374x</span>
<span class="cline-any cline-yes">274x</span>
<span class="cline-any cline-yes">78x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">274x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9100x</span>
<span class="cline-any cline-yes">507x</span>
<span class="cline-any cline-yes">195x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">507x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9374x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11482x</span>
<span class="cline-any cline-yes">11482x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11482x</span>
<span class="cline-any cline-yes">11482x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1054x</span>
<span class="cline-any cline-yes">1054x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1054x</span>
<span class="cline-any cline-yes">1054x</span>
<span class="cline-any cline-yes">1054x</span>
<span class="cline-any cline-yes">1054x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1054x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1054x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1057x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1057x</span>
<span class="cline-any cline-yes">1017x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1017x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">40x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">40x</span>
<span class="cline-any cline-yes">39x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2073x</span>
<span class="cline-any cline-yes">2073x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1486x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">'use strict';
&nbsp;
// Dependencies:
import DumbBinarySearchTree from "./dumb_binary_search_tree";
&nbsp;
// API:
// Most methods can utilize the generic DumbBinarySearchTree's methods.
// Searching, getting the size, and updating counts, are all exactly the same.
//
// However, anything related to actually adding/removing nodes from the
// tree will have to override in order to utilize AVL tree balancing.
AVLTree.prototype = Object.create(DumbBinarySearchTree.prototype);
AVLTree.prototype.constructor = AVLTree;
&nbsp;
AVLTree.prototype._buildNode = _buildNode;
AVLTree.prototype._addNewNode = _addNewNode;
AVLTree.prototype._removeNode = _removeNode;
&nbsp;
AVLTree.prototype._rotateLeft = buildRotationFn("rightChild", "leftChild");
AVLTree.prototype._rotateRight = buildRotationFn("leftChild", "rightChild");
AVLTree.prototype._updateParentReference = _updateParentReference;
&nbsp;
// Exit:
export default AVLTree;
&nbsp;
// Functions:
function AVLTree(config){ // Constructor:
	return DumbBinarySearchTree.apply(this, arguments);
}
&nbsp;
function _buildNode(value){ // Constructor:
	return {
		parent: null,
		value: value,
		leftChild: undefined,
		rightChild: undefined,
		count: 1,
&nbsp;
		// AVL Tree properties:
		height: 1,
		balancingFactor: 0, // Number of levels below (and including) this
	};
}
&nbsp;
function _addNewNode(node, closestNode){
	node.parent = closestNode;
&nbsp;
	if(node.value &lt; closestNode.value){
		closestNode.leftChild = node;
	}
	else {
		closestNode.rightChild = node;
	}
&nbsp;
	rebalanceUp.call(this, closestNode); // AVL TIME!
}
&nbsp;
function _removeNode(node){
	if(node.leftChild &amp;&amp; node.rightChild){
		let weighedLeft = (node.balancingFactor &gt;= 0);
		let side = w</span>eighedLeft ? 'leftChild' : <span class="branch-1 cbranch-no" title="branch not covered" >'rightChild';
		let replacement = w</span>eighedLeft ? _largestDescendent(node[side]) : <span class="branch-1 cbranch-no" title="branch not covered" >_smallestDescendent(node[side]);
		let replacementsParent = replacement.parent;
		let replacementsChild = replacement[side]; // If it exists
&nbsp;
		this._updateParentReference(replacement, replacementsChild);
&nbsp;
		// Update references of node-being-removed's children to point to its replacement
		setChild(replacement, 'leftChild', node.leftChild);
		setChild(replacement, 'rightChild', node.rightChild);
&nbsp;
		// Update the node's parent to hold the replacement as its child
		this._updateParentReference(node, replacement);
		rebalanceUp.call(this, replacementsChild || replacementsParent); // Lowest relevant node
	}
	else {
		let child = node.leftChild || node.rightChild;
		let parent = node.parent;
&nbsp;
		this._updateParentReference(node, child); // So I'm lazy...
		rebalanceUp.call(this, parent);
	}
}
&nbsp;
function _largestDescendent(node){
	while(node.rightChild){ node = node.rightChild; }
	return node;
}
&nbsp;
<span class="fstat-no" title="function not covered" >function _smallestDescendent(node){</span>
<span class="cstat-no" title="statement not covered" ></span>	while(node.leftChild){</span> <span class="cstat-no" title="statement not covered" >node = node.leftChild; }
<span class="cstat-no" title="statement not covered" >	return node;</span>
}
&nbsp;
function rebalanceUp(closestNode){
	while(closestNode){
		updateHeightAndBalance(closestNode);
&nbsp;
		if(closestNode.balancingFactor &gt; 1) { // Pivot up the left side:
			if(closestNode.leftChild.balancingFactor &lt; 0){ // Double right:
				this._rotateLeft(closestNode.leftChild);
			}
			this._rotateRight(closestNode);
		}
		else if(closestNode.balancingFactor &lt; -1) { // Pivot up the right:
			if(closestNode.rightChild.balancingFactor &gt; 0){ // Double left:
				this._rotateRight(closestNode.rightChild);
			}
			this._rotateLeft(closestNode);
		}
&nbsp;
		closestNode = closestNode.parent;
	}
}
&nbsp;
function updateHeightAndBalance(node){
	let leftChildHeight = node.leftChild ? node.leftChild.height : 0;
	let rightChildHeight = node.rightChild ? node.rightChild.height : 0;
&nbsp;
	node.height = Math.max(leftChildHeight, rightChildHeight) + 1;
	node.balancingFactor = leftChildHeight - rightChildHeight;
}
&nbsp;
function buildRotationFn(liftedProp, otherProp){
	return function (node){
		let liftedChild = node[liftedProp];
&nbsp;
		setChild(node, liftedProp, liftedChild[otherProp])
		liftedChild[otherProp] = node;
		this._updateParentReference(node, liftedChild);
		node.parent = liftedChild;
&nbsp;
		// Update heights and balances:
		// TODO: I expect there's a more clever way to do this,
		//      (e.g. liftedChild height -1 or -2 based on if otherProp was lifted, etc.)
		updateHeightAndBalance(node);
		updateHeightAndBalance(liftedChild);
&nbsp;
		return liftedChild;
	}
}
&nbsp;
function _updateParentReference(node, newChild){
	let parent = node.parent;
&nbsp;
	if(parent){
		let childProperty = (parent.rightChild === node) ? "rightChild" : "leftChild";
&nbsp;
		setChild(parent, childProperty, newChild);
	}
	else {
		this.head = newChild;
&nbsp;
		if(newChild){
			newChild.parent = null;
		}
	}
}
&nbsp;
function setChild(node, prop, child){
	node[prop] = child; // Do this part regardless to allow overwriting with undefined values
	if(child){
		child.parent = node;
	}
}</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sat Mar 19 2016 09:33:25 GMT-0700 (PDT)
</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
